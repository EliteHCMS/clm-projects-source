import{l as R,bD as L,bR as k,bX as U,bE as M,r as q,o as I,w as Y,c as m,cG as J,_ as C,p as _,t as g,v as e,ag as A,bb as p,d as i,F as W,aR as D,bJ as E,bK as O,a4 as y,y as P,ah as Q,aS as b,bC as $,c1 as G,c2 as H}from"./index.88560b98.js";import{Q as T,a as F,b as N,c as z}from"./QTabPanels.1d28f334.js";import{Q as S}from"./QMarkupTable.5453b11b.js";import{Q as K}from"./QSplitter.5e33219e.js";import{a as B,s as V}from"./analytics.601b6ff4.js";function l(t,o=document.body){if(typeof t!="string")throw new TypeError("Expected a string as propName");if(!(o instanceof Element))throw new TypeError("Expected a DOM element");return getComputedStyle(o).getPropertyValue(`--q-${t}`).trim()||null}const X=R({components:{},setup(){const t=L();t.loadingBar.setDefaults({color:"accent",size:"10px",position:"top"});const{assignmentsForProject:o}=k(U()),{projectCrafts:u}=k(M()),f=q(null),d=q(null),h=q(null),s=["bg-primary text-white","bg-info text-white","bg-accent text-dark","bg-dark text-white"];return I(async()=>{t.loadingBar.start(),o.value.length>0&&(d.value=await B.calcRateData({assignments:o.value.filter(n=>!n[112]),projectCrafts:u.value}),f.value=d.value[0][3]),t.loadingBar.stop()}),Y(o,async()=>{h.value=null,t.loadingBar.start(),o.value.length>0&&(d.value=await B.calcRateData({assignments:o.value.filter(n=>!n[112]),projectCrafts:u.value}),f.value=d.value[0][3]),t.loadingBar.stop()}),Y(h,async(n,x)=>{h.value&&console.log(h.value)}),{craftWageArray:m(()=>d.value?d.value:[]),colors:s,clickedCraft:h,tab:f,splitValue:q(20),helpers:J}}}),Z={class:"row text-caption"},j={class:"col-12 col-md-2"},ee=e("div",null,[e("span",{class:"text-accent"},"Total Employees:")],-1),te={class:"text-white q-ml-sm"},se={class:"col-12 col-md-2"},ae=e("div",null,[e("span",{class:"text-accent"},"Classifications:")],-1),ne={class:"text-white q-ml-sm"},oe={class:"col-12 col-md-2"},le=e("div",null,[e("span",{class:"text-accent"},"Avg. Wage:")],-1),re={class:"text-white q-ml-sm"},ce={class:"col-12 col-md-2"},ie=e("div",null,[e("span",{class:"text-accent"},"Avg. Craft Wage:")],-1),ue={class:"text-white q-ml-sm"},de={class:"col-12 col-md-3"},pe=e("div",null,[e("span",{class:"text-accent"},"Wage Status")],-1),me={class:"text-white q-ml-sm"},he=e("thead",{class:"bg-dark text-white"},[e("tr",null,[e("th",{class:"text-left"},"Job Title"),e("th",{class:"text-right"},"# of Employees"),e("th",{class:"text-right"},"Fixed Rate"),e("th",{class:"text-right"},"Average Rate"),e("th",{class:"text-right"},"Difference")])],-1),_e=["onClick"],fe={class:"text-left"},ve={class:"text-right"},ge={class:"text-right"},ye={class:"text-right"},$e={class:"text-right"},xe={key:1},be=e("td",{colspan:"100%",class:"text-center"},"No classifications to show",-1),qe=[be],we={key:2},Re={colspan:"100%"},Ce=e("thead",{class:"bg-dark text-white"},[e("tr",null,[e("th",{class:"text-left"},"Name"),e("th",{class:"text-left"},"Employee ID"),e("th",{class:"text-left"},"Payroll ID"),e("th",{class:"text-left"},"Job Number"),e("th",{class:"text-right"},"Rate")])],-1),ke={class:"text-left"},We={class:"text-left"},Ve={class:"text-left"},Me={class:"text-left"},De={class:"text-right"},Ae={key:1},Ee=e("div",{class:"text-h6"},"Not available on mobile yet.",-1),Oe=[Ee];function Qe(t,o,u,f,d,h){return _(),g("div",null,[e("div",null,[t.$q.screen.gt.sm&&t.craftWageArray?(_(),A(K,{key:0,modelValue:t.splitValue,"onUpdate:modelValue":o[2]||(o[2]=s=>t.splitValue=s)},{before:p(()=>[i(F,{modelValue:t.tab,"onUpdate:modelValue":o[0]||(o[0]=s=>t.tab=s),vertical:t.$q.screen.gt.md,align:"left","indicator-color":"accent","active-bg-color":"dark","active-color":"white"},{default:p(()=>[(_(!0),g(W,null,D(t.craftWageArray,s=>(_(),A(T,{key:s[3],name:s[3],label:s[10]},null,8,["name","label"]))),128))]),_:1},8,["modelValue","vertical"])]),after:p(()=>[i(z,{modelValue:t.tab,"onUpdate:modelValue":o[1]||(o[1]=s=>t.tab=s),animated:"",vertical:t.$q.screen.gt.md},{default:p(()=>[(_(!0),g(W,null,D(t.craftWageArray,s=>(_(),A(N,{key:s[3],name:s[3],class:"q-pt-none"},{default:p(()=>[e("div",null,[i(E,{class:"q-mb-md bg-dark"},{default:p(()=>[i(O,{class:"q-pa-sm"},{default:p(()=>[e("div",Z,[e("div",j,[ee,e("div",null,[e("span",te,y(s.craftRoster.length),1)])]),e("div",se,[ae,e("div",null,[e("span",ne,y(s.classifications.length),1)])]),e("div",oe,[le,e("div",null,[e("span",re,"$"+y(s.avgWage.toFixed(2)),1)])]),e("div",ce,[ie,e("div",null,[e("span",ue,"$"+y(s.avgCraftWorkerWage.toFixed(2)),1)])]),e("div",de,[pe,e("div",null,[e("span",me,y(s.highWages?`${s.highWageCount} with High Wages`:"Good"),1)])])])]),_:2},1024)]),_:2},1024),i(S,null,{default:p(()=>[he,e("tbody",null,[(_(!0),g(W,null,D(s.classifications,a=>(_(),g(W,{key:a[3]},[a?(_(),g("tr",{key:0,class:P(["cursor-pointer",a.analytics.highWages?"bg-negative text-white":""]),onClick:n=>a.expanded=!a.expanded},[e("td",fe,y(a[18]),1),e("td",ve,y(a.analytics.roster.length),1),e("td",ge,y(a.analytics.fixedWage>0?`$${a.analytics.fixedWage.toFixed(2)}`:"N/A"),1),e("td",ye,y(a.analytics.avgWage>0?`$${a.analytics.avgWage.toFixed(2)}`:"N/A"),1),e("td",$e,y(a.analytics.avgWage>0&&a.analytics.fixedWage>0?`${a.analytics.diff>0?"+":""}${a.analytics.diff}`:"N/A"),1)],10,_e)):Q("",!0),a?Q("",!0):(_(),g("tr",xe,qe)),a.expanded?(_(),g("tr",we,[e("td",Re,[i(S,{dense:""},{default:p(()=>[Ce,e("tbody",null,[(_(!0),g(W,null,D(a.analytics.roster,n=>(_(),g("tr",{key:n[3],class:P(n[116]>a.analytics.fixedWage&&a.analytics.fixedWage>0?"bg-accent":"")},[e("td",ke,y(t.helpers.formatName(n[75])),1),e("td",We,y(n.employee[378]),1),e("td",Ve,y(n.employee[213]===""?"N/A":n.employee[213]),1),e("td",Me,y(n[105]),1),e("td",De,"$"+y(n[116].toFixed(2)),1)],2))),128))])]),_:2},1024)])])):Q("",!0)],64))),128))])]),_:2},1024)])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue","vertical"])]),_:1},8,["modelValue"])):(_(),g("div",Ae,Oe))])])}var Te=C(X,[["render",Qe]]);const Ne=R({setup(){const{active:t}=k(M()),o=m(()=>t.value.openRequests.concat(t.value.closedRequests.concat(t.value.pendingRequests)).sort((n,x)=>n[1].$d>x[1].$d?1:-1)),u=m(()=>{const a=[...new Map(o.value.map(n=>[n[282],{type:n[282]}])).values()];return a.forEach(n=>{Object.assign(n,{count:o.value.filter(x=>x[282]===n.type).length})}),a}),f=m(()=>u.value.map(a=>a.type)),d=m(()=>u.value.map(a=>a.count)),h={title:{text:"Request Type",align:"center",style:{color:l("primary"),fontWeight:"regular"}},labels:f.value,dataLabels:{enabled:!0},colors:[l("primary"),l("accent"),l("info"),l("secondary")],legend:{show:!0,position:"bottom",horizontalAlign:"center"},plotOptions:{expandOnClick:!0},stroke:{show:!1}},s=m(()=>({}));return{getCssVar:l,options:h,series:d,echartOptions:s}}});function Ye(t,o,u,f,d,h){const s=b("apexchart");return _(),g("div",null,[i(E,{class:"q-ma-sm chart-wrapper"},{default:p(()=>[i(O,null,{default:p(()=>[i(s,{height:"auto",type:"pie",options:t.options,series:t.series},null,8,["options","series"])]),_:1})]),_:1})])}var Pe=C(Ne,[["render",Ye]]);const Se=R({setup(){const{active:t}=k(M()),o=m(()=>t.value.openRequests.concat(t.value.closedRequests.concat(t.value.pendingRequests)).sort((a,n)=>a[1].$d>n[1].$d?1:-1)),u=m(()=>{const s=[...new Map(o.value.map(a=>[a[284],{type:a[284]}])).values()];return s.forEach(a=>{Object.assign(a,{count:o.value.filter(n=>n[284]===a.type).length})}),s}),f=m(()=>u.value.map(s=>s.type)),d=m(()=>u.value.map(s=>s.count)),h={title:{text:"Request Reason",align:"center",style:{color:l("primary"),fontWeight:"regular"}},labels:f.value,dataLabels:{enabled:!0},colors:[l("accent"),l("primary"),l("info"),l("secondary")],legend:{show:!0,position:"bottom",horizontalAlign:"center"},plotOptions:{expandOnClick:!0},stroke:{show:!1}};return{getCssVar:l,options:h,series:d}}});function Be(t,o,u,f,d,h){const s=b("apexchart");return _(),g("div",null,[i(E,{class:"q-ma-sm chart-wrapper"},{default:p(()=>[i(O,null,{default:p(()=>[i(s,{height:"auto",type:"pie",options:t.options,series:t.series},null,8,["options","series"])]),_:1})]),_:1})])}var Fe=C(Se,[["render",Be]]);const ze=[l("info"),l("accent"),l("primary"),l("secondary"),l("dark"),l("negative"),l("positive"),l("cyan"),l("green"),l("amber"),l("blue-grey"),l("teal")],Le=R({components:{},setup(){const{active:t}=k(M()),o=m(()=>{const v=[];return t.value.openRequests.concat(t.value.closedRequests.concat(t.value.pendingRequests)).sort((r,w)=>r[1].$d>w[1].$d?1:-1).forEach(r=>{r.classes.forEach(w=>{v.push(w)})}),v.filter(r=>r.isCraft).sort((r,w)=>r[1].$d>w[1].$d?1:-1)}),u=m(()=>{const v=[...new Map(o.value.map(c=>[c[43],{type:c[43],id:c[244]}])).values()];return v.forEach(c=>{Object.assign(c,{count:V(o.value.filter(r=>r[244]===c.id).map(r=>r[18])),offers:V(o.value.filter(r=>r[244]===c.id).map(r=>r.offers.length))})}),v}),f=m(()=>{const v=[...new Map(o.value.map(c=>[c[43],{type:c[43],id:c[244]}])).values()];return v.forEach(c=>{Object.assign(c,{count:V(o.value.filter(r=>r[244]===c.id).map(r=>r[18])),offers:V(o.value.filter(r=>r[244]===c.id).map(r=>r.offers.length)),array:o.value.filter(r=>r[244]===c.id).map(r=>({need:r[18],date:r[1]}))})}),v}),d=m(()=>u.value.map(v=>v.type)),h=m(()=>[...new Map(o.value.map(c=>[`${$().month(c[1].$m).format("MMM")} ${$().year(c[1].$y).format("YYYY")}`,{label:`${$().month(c[1].$m).format("MMM")} ${$().year(c[1].$y).format("YYYY")}`,sorter:$().set("month",c[1].$m).set("year",c[1].$y)}])).values()].sort((c,r)=>c.sorter>r.sorter?1:-1).map(c=>c.label)),s=m(()=>[{data:[...new Map(o.value.map(c=>[`${$().month(c[1].$m).format("MMM")} ${$().year(c[1].$y).format("YYYY")}`,V(c[18])])).values()]}]),a=m(()=>u.value.map(v=>v.count)),n={title:{text:"Total Craft Requested",align:"center",style:{color:l("primary")}},xaxis:{categories:h.value},dataLabels:{enabled:!1},colors:[l("info"),l("accent"),l("primary"),l("secondary"),l("dark"),l("negative"),l("positive"),l("cyan"),l("green"),l("amber"),l("blue-grey"),l("teal")],legend:{show:!0,position:"bottom",horizontalAlign:"center"},plotOptions:{expandOnClick:!0},stroke:{curve:"smooth"},chart:{type:"area"}},x=m(()=>{const v=u.value.map((r,w)=>({x:r.type,y:r.count,fillColor:ze[w]})).filter(r=>r.y>0);return{chartOptions:{title:{text:"Requested Quantity by Craft",align:"center",style:{color:l("primary"),fontWeight:"regular"}},chart:{type:"bar"},plotOptions:{bar:{horizontal:!0,distributed:!1,colors:{},dataLabels:{position:"center"}}}},series:[{data:v}]}});return console.log(f.value),console.log(s.value),{getCssVar:l,options:n,series:a,barOptions:x,lineSeries:s,labels:d}}});function Ue(t,o,u,f,d,h){const s=b("apexchart");return _(),g("div",null,[i(E,{class:"q-ma-sm chart-wrapper"},{default:p(()=>[i(O,null,{default:p(()=>[i(s,{height:"auto",options:t.options,series:t.lineSeries},null,8,["options","series"])]),_:1})]),_:1})])}var Ie=C(Le,[["render",Ue],["__scopeId","data-v-925ca780"]]);const Je=R({components:{RequestTypeChart:Pe,RequestReasonChart:Fe,QuantityPerCraftChart:Ie},setup(){const t=q($("2022-01-01")),o=q($()),{active:u}=k(M()),f=q(null),d=m(()=>u.value.openRequests.concat(u.value.closedRequests).filter(n=>$(n[1].$d).isAfter(t.value)&&$(n[1].$d).isSameOrBefore(o.value)).sort((n,x)=>n[1].$d>x[1].$d?1:-1)),h=m(()=>u.value.crafts),s=m(()=>{const a=[...new Map(d.value.map(n=>[n[282],{type:n[282]}])).values()];return a.forEach(n=>{Object.assign(n,{count:d.value.filter(x=>x[282]===n.type).length})}),a});return{start:t,end:o,requestData:f,allRequests:d,allCrafts:h,requestTypeData:s}}}),Ge={class:"row"},He={class:"col-12 col-md-7 q-px-xs"},Ke={class:"col-12 col-md-5 q-px-xs"},Xe={class:"row justify-end"},Ze={class:"col-12 col-md-12 q-px-lg"};function je(t,o,u,f,d,h){const s=b("quantity-per-craft-chart"),a=b("request-type-chart"),n=b("request-reason-chart");return _(),g("div",null,[e("div",Ge,[e("div",He,[i(s)]),e("div",Ke,[e("div",Xe,[e("div",Ze,[i(a),i(n)])])])])])}var et=C(Je,[["render",je]]);const tt=R({components:{RatesPanel:Te,RequestsPanel:et},setup(){return{tab:q(0)}}}),st={class:"q-px-sm"};function at(t,o,u,f,d,h){const s=b("rates-panel"),a=b("requests-panel");return _(),g("div",st,[i(G,{class:"bg-info text-white shadow-2 rounded-borders"},{default:p(()=>[i(F,{modelValue:t.tab,"onUpdate:modelValue":o[0]||(o[0]=n=>t.tab=n),"bg-color":"none","indicator-color":"accent"},{default:p(()=>[i(T,{name:0,label:"Rates"}),i(T,{name:1,label:"Requests"})]),_:1},8,["modelValue"])]),_:1}),i(z,{modelValue:t.tab,"onUpdate:modelValue":o[1]||(o[1]=n=>t.tab=n),animated:""},{default:p(()=>[i(N,{name:0},{default:p(()=>[i(s)]),_:1}),i(N,{name:1},{default:p(()=>[i(a)]),_:1})]),_:1},8,["modelValue"])])}var nt=C(tt,[["render",at]]);const ot=R({name:"Analytics",components:{Dash:nt},setup(){return{}}});function lt(t,o,u,f,d,h){const s=b("dash");return _(),A(H,{style:{"max-width":"100vw"}},{default:p(()=>[i(s)]),_:1})}var pt=C(ot,[["render",lt]]);export{pt as default};
