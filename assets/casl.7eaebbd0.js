import{l as y,m as b,r as g,i as h,f as m,z as v,n as l,q as a}from"./index.d258f966.js";function w(e){if(e.hasOwnProperty("possibleRulesFor"))return e;var i=g(!0);e.on("updated",function(){i.value=!i.value});var t=e.possibleRulesFor.bind(e);return e.possibleRulesFor=function(n,r){return i.value=i.value,t(n,r)},e.can=e.can.bind(e),e.cannot=e.cannot.bind(e),e}var d=Symbol("ability");function q(){var e=h(d);if(!e)throw new Error("Cannot inject Ability instance because it was not provided");return e}function I(e){return"a"in e?"a":"this"in e?"this":"an"in e?"an":""}y({name:"Can",props:{I:String,do:String,a:[String,Function],an:[String,Function],this:[String,Function,Object],on:[String,Function,Object],not:Boolean,passThrough:Boolean,field:String},setup:function(i,t){var n=t.slots,r=i,o="do",s="on";if(o in i||(o="I",s=I(i)),!r[o])throw new Error("Neither `I` nor `do` prop was passed in <Can>");if(!n.default)throw new Error("Expects to receive default slot");var c=q();return function(){var f=c.can(r[o],r[s],r.field),u=i.not?!f:f;return i.passThrough?n.default({allowed:u,ability:c}):u?n.default():null}}});function P(e,i,t){if(!i||!(i instanceof b))throw new Error("Please provide an Ability instance to abilitiesPlugin plugin");e.provide(d,w(i)),t&&t.useGlobalProperties&&(e.config.globalProperties.$ability=i,e.config.globalProperties.$can=i.can.bind(i))}const S=e=>e.matched.some(i=>l.can(i.meta.action||"read",i.meta.resource));var F=m(({app:e,router:i})=>{e.config.globalProperties.$subject=v,e.use(P,l,{useGlobalProperties:!0}),i.beforeEach(async(t,n,r)=>{const o=await a.isUserLoggedIn(),s=Object.assign({},t.query);if(!o)a.logout();else if(n.fullPath==="/"&&n.name===void 0)await a.reloadUserInfo({reAuthenticate:!0});else if(S(t)){if(t.meta.redirectIfLoggedIn)return r("/")}else return r({name:"not-authorized"});s.office_id&&(a.setOfficeLocation({rid:s.office_id}),s.qr&&a.setCheckIn(!0));const c=await a.phoneNumberVerifyRequired(),f=await a.employeeLinkRequired(),u=await a.getUserFromStore(),p=await a.getSocialRequired();if(c)return n.name==="code-confirmation"&&o&&t.query.code?(await a.setPhoneNumberVerified(!0),r({path:"/"})):t.name!=="code-confirmation"?r({name:"code-confirmation",query:{p:u[9]?u[9].phoneNumber:u[8].replace(/[^0-9]/g,""),rid:u[3]}}):r();if(f||p)return n.name==="verify-identity"&&o&&t.query.verify?(t.query.rid?await a.setIdentityVerified(t.query.rid):await a.setIdentityVerified(!1),r({path:"/",query:{}})):t.name!=="verify-identity"?r({name:"verify-identity",query:{rid:u[3]}}):r();if(t.name==="verify-identity"){if(!f)return r({path:"/"})}else if(t.name==="code-confirmation")return!o&&t.query.ac?r():r({path:"/"});return r()}),i.afterEach(async(t,n)=>{const r=await a.isUserLoggedIn();n.fullPath==="/"&&!n.name&&r&&await a.updateStore({reAuthenticate:!1})})});export{F as default};
