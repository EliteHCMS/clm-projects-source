import{l as S,bD as z,bR as A,cG as I,bX as H,bE as J,r as $,c as D,bC as C,o as U,w as N,c_ as G,_ as B,p as l,t as n,v as e,ag as b,bb as r,d,F as p,aR as y,bJ as F,bK as w,a4 as o,y as v,ah as x,b_ as O,an as K,bO as L,bP as X,aS as Y,c2 as Z}from"./index.f1c31f20.js";import{Q as j,a as ee,b as te,c as ae}from"./QTabPanels.218dab0f.js";import{Q as R}from"./QMarkupTable.82653f3f.js";import{Q as se}from"./QSplitter.44aaba9c.js";import{analytics as T}from"./analytics.6787a861.js";const le=S({components:{},setup(){const a=z();a.loadingBar.setDefaults({color:"accent",size:"10px",position:"top"});const{openRequestsForProject:h,closedRequestsForProject:q}=A(I()),{assignmentsForProject:m}=A(H()),{projectCrafts:k}=A(J()),f=$(null),t=$(null),s=$(null),u=["bg-primary text-white","bg-info text-white","bg-accent text-dark","bg-dark text-white"],M=D(()=>{const Q=h.value.concat(q.value).filter(i=>C(i[1].$y).isSame(C().year())),W=[];Q.forEach(i=>{i.classes.forEach(c=>{const g={x:C(i[1].$d).format("MMM"),y:c.need,43:c[43],69:c[69],sort:C(i[1].$d).format("M"),date:i[1].$d};W.push(g)})});const V=[...new Map(W.map(i=>[i[69],{label:i[43],value:i[69]}])).values()];return V.forEach(i=>{Object.assign(i,{name:i.label,data:[...new Map(W.filter(c=>c[69]===i.value).map(c=>[c.x,{x:c.x,y:W.filter(g=>g[69]===i.value).filter(g=>g.x===c.x).reduce((g,E)=>g+E.y,0),sort:parseInt(c.sort),date:c.date}])).values()].sort((c,g)=>c.sort>g.sort?1:-1)})}),V});U(async()=>{a.loadingBar.start(),m.value.length>0&&(t.value=await T.calcRateData({assignments:m.value.filter(_=>!_[112]),projectCrafts:k.value}),f.value=t.value[0][3]),a.loadingBar.stop()}),N(m,async()=>{s.value=null,a.loadingBar.start(),m.value.length>0&&(t.value=await T.calcRateData({assignments:m.value.filter(_=>!_[112]),projectCrafts:k.value}),f.value=t.value[0][3]),a.loadingBar.stop()}),N(s,async(_,Q)=>{s.value&&console.log(s.value)});const P=D(()=>t.value?t.value:[]);return{requestData:M,craftWageArray:P,colors:u,clickedCraft:s,tab:f,splitValue:$(20),helpers:G}}}),oe={class:"row text-caption"},ne={class:"col-12 col-md-2"},ie=e("div",null,[e("span",{class:"text-accent"},"Total Employees:")],-1),re={class:"text-white q-ml-sm"},ce={class:"col-12 col-md-2"},de=e("div",null,[e("span",{class:"text-accent"},"Classifications:")],-1),ue={class:"text-white q-ml-sm"},he={class:"col-12 col-md-2"},ge=e("div",null,[e("span",{class:"text-accent"},"Avg. Wage:")],-1),me={class:"text-white q-ml-sm"},pe={class:"col-12 col-md-2"},ve=e("div",null,[e("span",{class:"text-accent"},"Avg. Craft Wage:")],-1),fe={class:"text-white q-ml-sm"},_e={class:"col-12 col-md-3"},ye=e("div",null,[e("span",{class:"text-accent"},"Wage Status")],-1),xe={class:"text-white q-ml-sm"},be=e("thead",{class:"bg-dark text-white"},[e("tr",null,[e("th",{class:"text-left"},"Job Title"),e("th",{class:"text-right"},"# of Employees"),e("th",{class:"text-right"},"Fixed Rate"),e("th",{class:"text-right"},"Average Rate"),e("th",{class:"text-right"},"Difference"),e("th",{class:"text-right"},"Avg. Time to Arrive")])],-1),ke=["onClick"],We={class:"text-left"},$e={class:"text-right"},Ce={class:"text-right"},we={class:"text-right"},qe={class:"text-right"},Ae={class:"text-right"},Qe={key:1},Ve=e("td",{colspan:"100%",class:"text-center"},"No classifications to show",-1),De=[Ve],Ne={key:2},Fe={colspan:"100%"},Re=e("thead",{class:"bg-dark text-white"},[e("tr",null,[e("th",{class:"text-left"},"Name"),e("th",{class:"text-left"},"Employee ID"),e("th",{class:"text-left"},"Payroll ID"),e("th",{class:"text-left"},"Job Number"),e("th",{class:"text-right"},"Rate")])],-1),Te={class:"text-left"},Se={class:"text-left"},Be={class:"text-left"},Me={class:"text-left"},Pe={class:"text-right"},Ee={key:1},ze=e("div",{class:"text-h6"},"Not available on mobile yet.",-1),Ie=[ze],He={key:2,class:"row"},Je={key:0},Ue={key:1};function Ge(a,h,q,m,k,f){return l(),n("div",null,[e("div",null,[a.$q.screen.gt.sm&&a.craftWageArray?(l(),b(se,{key:0,modelValue:a.splitValue,"onUpdate:modelValue":h[2]||(h[2]=t=>a.splitValue=t)},{before:r(()=>[d(ee,{modelValue:a.tab,"onUpdate:modelValue":h[0]||(h[0]=t=>a.tab=t),vertical:a.$q.screen.gt.md,align:"left","indicator-color":"accent","active-bg-color":"dark","active-color":"white"},{default:r(()=>[(l(!0),n(p,null,y(a.craftWageArray,t=>(l(),b(j,{key:t[3],name:t[3],label:t[10]},null,8,["name","label"]))),128))]),_:1},8,["modelValue","vertical"])]),after:r(()=>[d(ae,{modelValue:a.tab,"onUpdate:modelValue":h[1]||(h[1]=t=>a.tab=t),animated:"",vertical:a.$q.screen.gt.md},{default:r(()=>[(l(!0),n(p,null,y(a.craftWageArray,t=>(l(),b(te,{key:t[3],name:t[3],class:"q-pt-none"},{default:r(()=>[e("div",null,[d(F,{class:"q-mb-md bg-dark"},{default:r(()=>[d(w,{class:"q-pa-sm"},{default:r(()=>[e("div",oe,[e("div",ne,[ie,e("div",null,[e("span",re,o(t.craftRoster.length),1)])]),e("div",ce,[de,e("div",null,[e("span",ue,o(t.classifications.length),1)])]),e("div",he,[ge,e("div",null,[e("span",me,"$"+o(t.avgWage.toFixed(2)),1)])]),e("div",pe,[ve,e("div",null,[e("span",fe,"$"+o(t.avgCraftWorkerWage.toFixed(2)),1)])]),e("div",_e,[ye,e("div",null,[e("span",xe,o(t.highWages?`${t.highWageCount} with High Wages`:"Good"),1)])])])]),_:2},1024)]),_:2},1024),d(R,null,{default:r(()=>[be,e("tbody",null,[(l(!0),n(p,null,y(t.classifications,s=>(l(),n(p,{key:s[3]},[s?(l(),n("tr",{key:0,class:v(["cursor-pointer",s.analytics.highWages?"bg-negative text-white":""]),onClick:u=>s.expanded=!s.expanded},[e("td",We,o(s[18]),1),e("td",$e,o(s.analytics.roster.length),1),e("td",Ce,o(s.analytics.fixedWage>0?`$${s.analytics.fixedWage.toFixed(2)}`:"N/A"),1),e("td",we,o(s.analytics.avgWage>0?`$${s.analytics.avgWage.toFixed(2)}`:"N/A"),1),e("td",qe,o(s.analytics.avgWage>0&&s.analytics.fixedWage>0?`${s.analytics.diff>0?"+":""}${s.analytics.diff}`:"N/A"),1),e("td",Ae,o(s.analytics.averageTimeToArrive.format),1)],10,ke)):x("",!0),s?x("",!0):(l(),n("tr",Qe,De)),s.expanded?(l(),n("tr",Ne,[e("td",Fe,[d(R,{dense:""},{default:r(()=>[Re,e("tbody",null,[(l(!0),n(p,null,y(s.analytics.roster,u=>(l(),n("tr",{key:u[3],class:v(u[116]>s.analytics.fixedWage&&s.analytics.fixedWage>0?"bg-accent":"")},[e("td",Te,o(a.helpers.formatName(u[75])),1),e("td",Se,o(u.employee[378]),1),e("td",Be,o(u.employee[213]===""?"N/A":u.employee[213]),1),e("td",Me,o(u[105]),1),e("td",Pe,"$"+o(u[116].toFixed(2)),1)],2))),128))])]),_:2},1024)])])):x("",!0)],64))),128))])]),_:2},1024)])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue","vertical"])]),_:1},8,["modelValue"])):(l(),n("div",Ee,Ie)),a.craftWageArray&&a.craftWageArray.length>0?(l(),n("div",He,[(l(!0),n(p,null,y(a.craftWageArray,t=>(l(),n("div",{class:"col-6 col-md-3 q-px-sm q-pb-sm",key:t[3]},[d(F,null,{default:r(()=>[d(w,{class:"bg-white vertical-middle text-center"},{default:r(()=>[e("div",{class:v(a.$q.screen.lt.md?"text-body1":(t[10].length>12,"text-h6"))},[t.highWages?(l(),b(O,{key:0,size:(a.$q.screen.gt.sm,"sm"),name:"straight",color:"negative"},null,8,["size"])):x("",!0),K(" "+o(t[10]),1)],2)]),_:2},1024),d(w,{class:"text-center q-py-xs"},{default:r(()=>[e("div",{class:v(a.$q.screen.lt.md||a.craftWageArray.length>4?"text-h6":"text-h5")},[e("span",{class:v(t.highWages?"text-negative":"text-positive")}," $"+o(t.avgWage.toFixed(2)),3)],2)]),_:2},1024),d(w,{class:"text-center q-px-xs q-pt-none"},{default:r(()=>[e("div",{class:v(["text-caption",t.highWages?"text-negative":"text-positive"])},[t.highWages?(l(),n("span",Je,o(t.highWageCount)+" job"+o(t.highWageCount>1?"s":"")+" with average above fixed rate ",1)):(l(),n("span",Ue,"Wages are at or below fixed rate"))],2)]),_:2},1024),d(L,{align:"center"},{default:r(()=>[d(X,{label:a.clickedCraft&&a.clickedCraft[3]===t[3]?"Hide Details":"Show More Details",color:"info",dense:"",icon:a.clickedCraft&&a.clickedCraft[3]===t[3]?"visibility_off":"visibility",onClick:s=>!a.clickedCraft||a.clickedCraft[3]!==t[3]?a.clickedCraft=t:a.clickedCraft=null},null,8,["label","icon","onClick"])]),_:2},1024)]),_:2},1024)]))),128))])):x("",!0)])])}var Oe=B(le,[["render",Ge]]);const Ke=S({name:"Analytics",components:{Dash:Oe},setup(){return{}}});function Le(a,h,q,m,k,f){const t=Y("dash");return l(),b(Z,{padding:"",style:{"max-width":"100vw"}},{default:r(()=>[d(t)]),_:1})}var tt=B(Ke,[["render",Le]]);export{tt as default};
