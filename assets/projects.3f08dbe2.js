import{l as O,bD as ie,bE as X,c as T,bF as Y,bG as Ue,bH as de,bI as j,q as Q,_ as L,p as d,t as c,v as l,d as o,bb as s,bJ as B,bK as F,a4 as m,bL as H,bM as J,bN as Je,bO as te,bP as V,by as oe,bQ as ae,bR as se,r as h,w as ke,aS as I,ag as E,F as x,aR as ee,ah as D,bS as Pe,bT as De,bU as Te,bV as M,y as S,bW as ve,al as je,bX as ne,bY as Ae,bZ as Fe,b_ as G,an as ye,bC as we,bd as qe,bw as Ve,b$ as Ne,c0 as Ce,c1 as Qe,c2 as Me}from"./index.41d00351.js";import{Q as K,a as be,b as Z,c as fe}from"./QTabPanels.e9973ee2.js";import{Q as Ee}from"./QMarkupTable.fad7f2fc.js";import{Q as Ie}from"./QSplitter.5ecd6b78.js";import{Q as Re}from"./QSpace.259352d6.js";import{Q as ge}from"./QTable.eb2af12a.js";import{Q as Oe}from"./QBadge.dd721ce4.js";const Le=O({props:{job:Object,craft:Object},setup(e,t){const i=ie(),{udpateProjectCrafts:p}=X(),u=T(()=>e.craft.options.jobs.find(f=>f[3]===e.job[13]).aliases),b=T(()=>Y({alias:Y().required().label("Custom Job Title"),fixedRate:Ue().moreThan(7.25,"Fixed rate must be greater than minimum wage.").lessThan(1e3).label("Fixed Rate").nullable()})),{meta:n,errors:a,handleSubmit:r,handleReset:$}=de({validationSchema:b,initialValues:{alias:{3:e.job[9],7:e.job[18]},fixedRate:e.job.fixedRate>0?e.job.fixedRate:null}}),{value:k}=j("alias"),{value:A}=j("fixedRate"),P=r(async g=>{console.log(g),i.loading.show();const f={3:{value:e.job[3]},20:{value:e.craft[3]}};k.value!=={3:e.job[9],7:e.job[18]}&&Object.assign(f,{9:{value:g.alias[3]}}),A.value!==e.job.fixedRate&&Object.assign(f,{155:{value:g.fixedRate}});try{const{data:y}=await Q.upsertRecordsXML({to:"bpzpx5m7x",data:[f],fieldsToReturn:[153],formatObject:153});y.length>0&&(p({craft:y[0][153]}),$(),i.loading.hide(),i.notify({type:"positive",message:"New job added!"}),t.emit("closeEditJob"))}catch{i.notify({type:"negative",message:"Something went wrong"})}});async function R(g,f){i.dialog({title:"Confirm",message:`Confirm you want to add "${g}" as a new alias.`,cancel:!0,persistent:!0}).onOk(async()=>{try{const{data:y}=await Q.upsertRecordsXML({to:"bpzpi5rjh",data:[{6:{value:e.job[13]},7:{value:g},11:{value:"No"}}],fieldsToReturn:[25],formatObject:25});console.log(y),y.length>0&&(k.value=y[0][25],f(y[0][25]))}catch{i.notify({type:"negative",message:"Something went wrong"})}}).onCancel(()=>{f()})}return{formMeta:n,formErrors:a,submit:P,alias:k,fixedRate:A,aliasOptions:u,submitAlias:R}}}),Ye={class:"text-body1 text-white"},ze={class:"text-caption"},Xe={class:"text-caption"};function Be(e,t,i,p,u,b){return d(),c("div",null,[l("div",null,[o(ae,{onSubmit:oe(e.submit,["prevent"])},{default:s(()=>[o(B,null,{default:s(()=>[o(F,{class:"bg-dark"},{default:s(()=>[l("div",Ye,"Edit "+m(e.craft[10])+" "+m(e.job[18]),1)]),_:1}),o(F,null,{default:s(()=>[o(H,{class:"q-mb-sm",dense:"",label:"Select Custom Job Title (Alias)","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.alias,"onUpdate:modelValue":t[0]||(t[0]=n=>e.alias=n),options:e.aliasOptions,"option-label":"7","display-value":`${e.alias?e.alias[7]:""}`,"bottom-slots":"",error:!!e.formErrors.alias,onNewValue:e.submitAlias,"use-input":""},{error:s(()=>[l("div",ze,m(e.formErrors.alias),1)]),_:1},8,["modelValue","options","display-value","error","onNewValue"]),o(J,{step:"any",prefix:"$",type:"number",dense:"",label:"Fixed Rate",modelValue:e.fixedRate,"onUpdate:modelValue":t[1]||(t[1]=n=>e.fixedRate=n),error:!!e.formErrors.fixedRate,"bottom-slots":""},{error:s(()=>[l("div",Xe,m(e.formErrors.fixedRate),1)]),_:1},8,["modelValue","error"])]),_:1}),o(Je),o(te,{class:"bg-accent",align:"right"},{default:s(()=>[o(V,{size:e.$q.screen.lt.md?"sm":"",color:"secondary",label:"Cancel",onClick:t[2]||(t[2]=n=>e.$emit("closeEditJob"))},null,8,["size"]),o(V,{type:"submit",size:e.$q.screen.lt.md?"sm":"",color:"primary",label:"Save"},null,8,["size"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])])}var We=L(Le,[["render",Be]]);const He=[{name:0,label:"Job Title",align:"left",field:e=>e[18],format:e=>`${e}`,sortable:!0,required:!0},{name:1,label:"Avg. Rate",align:"right",field:e=>e.avgRate,format:e=>`$ ${e.toFixed(2)}`,sortable:!0},{name:3,label:"Times Requested",align:"right",field:e=>e.timesRequested,format:e=>`${e}`,sortable:!0},{name:4,label:"Quantity Requested",align:"right",field:e=>e.qtyRequested,format:e=>`${e}`,sortable:!0}],Ge=O({components:{EditJobDialog:We},setup(){const e=ie(),{projectCrafts:t,active:i}=se(X()),{udpateProjectCrafts:p}=X(),u=h(t.value[0][3]),b=h(!1),n=h(!1),a=h(null),r=h(null);ke(i,(N,C)=>{u.value=N.crafts.sort((w,ce)=>w.order>ce.order?1:-1)[0][3]});const $=T(()=>{const N=t.value.find(C=>C[3]===u.value).classifications;return N!==void 0?N.sort((C,w)=>C.order>w.order||C.order===w.order&&C.fixedRate>w.fixedRate?-1:1):[]}),k=Y({job:Y().required("Job is required."),alias:Y().required("Alias is required.").nullable()}),{meta:A,errors:P,handleSubmit:R,handleReset:g}=de({validationSchema:k}),{value:f}=j("job"),{value:y}=j("alias"),_=R(async N=>{const C=t.value.find(w=>w[9]===N.job[13]);if(C===void 0)e.notify({type:"negative",message:"Something went wrong"});else try{const{data:w}=await Q.upsertRecordsXML({to:"bpzpx5m7x",data:[{9:{value:N.alias[3]},13:{value:N.job[3]},20:{value:C[3]}}],fieldsToReturn:[153],formatObject:153});w.length>0&&(p({craft:w[0][153]}),g(),b.value=!1,e.notify({type:"positive",message:"New job added!"}))}catch{e.notify({type:"negative",message:"Something went wrong"})}});async function W(N,C){e.dialog({title:"Confirm",message:`Confirm you want to add "${N}" as a new alias.`,cancel:!0,persistent:!0}).onOk(async()=>{try{const{data:w}=await Q.upsertRecordsXML({to:"bpzpi5rjh",data:[{6:{value:f.value[3]},7:{value:N},11:{value:"No"}}],fieldsToReturn:[25],formatObject:25});console.log(w),w.length>0&&(y.value=w[0][25],C(w[0][25]))}catch{e.notify({type:"negative",message:"Something went wrong"})}}).onCancel(()=>{C()})}function q(){b.value=!1,g()}function U({craft:N,job:C}){a.value=N,r.value=C,n.value=!0,console.log(N),console.log(C)}function le(){a.value=null,r.value=null,n.value=!1}return{projectCrafts:t,tab:u,columns:He,initialPagination:{rowsPerPage:100},splitValue:h(20),showAddJob:b,showEditJob:n,formMeta:A,formErrors:P,job:f,alias:y,submitJob:_,submitAlias:W,cancelAddJob:q,editJob:U,rows:$,editJobCraft:a,editJobJob:r,closeEditJob:le}}}),Ke={key:0},Ze={key:0,class:"q-mb-sm"},_e=l("thead",{class:"bg-dark text-white"},[l("tr",null,[l("th",{class:"text-left"},"Job Title"),l("th",{class:"text-right"},"Fixed Rate"),l("th",{class:"text-right"},"Times Requested"),l("th",{class:"text-right"},"Qty Requested"),l("th")])],-1),xe={class:"text-left"},et={class:"text-right"},tt={class:"text-right"},ot={class:"text-right"},at={class:"text-right"},st={key:1},lt={class:"row justify-between"},rt={class:"col-5"},nt={class:"text-caption"},it={class:"col-6"},dt={class:"text-caption"},ut={key:1},mt={key:0},pt={class:"q-mb-sm"},bt=l("thead",{class:"bg-dark text-white"},[l("tr",null,[l("th",{class:"text-left"},"Job Title"),l("th",{class:"text-right"},"Fixed Rate"),l("th",{class:"text-right"},"Avg. Rate"),l("th",{class:"text-right"},"Times Requested"),l("th",{class:"text-right"},"Quantity"),l("th")])],-1),ft={class:"text-left"},ct={class:"text-right"},gt={class:"text-right"},vt={class:"text-right"},yt={class:"text-right"},ht={class:"text-right"},$t={key:1},wt={class:"text-caption"},qt={class:"text-caption"};function Vt(e,t,i,p,u,b){const n=I("edit-job-dialog");return d(),c("div",null,[e.$q.screen.gt.sm?(d(),E(Ie,{key:0,modelValue:e.splitValue,"onUpdate:modelValue":t[5]||(t[5]=a=>e.splitValue=a)},{before:s(()=>[o(be,{modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=a=>e.tab=a),vertical:e.$q.screen.gt.md,align:"left","indicator-color":"accent","active-bg-color":"dark","active-color":"white"},{default:s(()=>[(d(!0),c(x,null,ee(e.projectCrafts,a=>(d(),E(K,{key:a[3],name:a[3],label:a[10]},null,8,["name","label"]))),128))]),_:1},8,["modelValue","vertical"])]),after:s(()=>[o(fe,{modelValue:e.tab,"onUpdate:modelValue":t[4]||(t[4]=a=>e.tab=a),animated:"",vertical:e.$q.screen.gt.md},{default:s(()=>[(d(!0),c(x,null,ee(e.projectCrafts,a=>(d(),E(Z,{key:a[3],name:a[3],class:"q-pt-none"},{default:s(()=>[e.showAddJob?(d(),c("div",st,[o(ae,{onSubmit:oe(e.submitJob,["prevent"])},{default:s(()=>[o(B,{flat:""},{default:s(()=>[o(F,null,{default:s(()=>[l("div",lt,[l("div",rt,[o(H,{class:"q-mb-sm",dense:"",label:"Select Default Job","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.job,"onUpdate:modelValue":t[2]||(t[2]=r=>e.job=r),options:a.options.jobs,"option-label":"9","display-value":`${e.job?e.job[9]:""}`,"bottom-slots":"",error:!!e.formErrors.job},{error:s(()=>[l("div",nt,m(e.formErrors.job),1)]),_:2},1032,["modelValue","options","display-value","error"])]),l("div",it,[o(H,{disable:!e.job,class:"q-mb-sm",dense:"",label:"Select Custom Job Title (Alias)","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.alias,"onUpdate:modelValue":t[3]||(t[3]=r=>e.alias=r),options:e.job?e.job.aliases:[],"option-label":"7","display-value":`${e.alias?e.alias[7]:""}`,"bottom-slots":"",error:!!e.formErrors.alias,onNewValue:e.submitAlias,"use-input":""},{error:s(()=>[l("div",dt,m(e.formErrors.alias),1)]),_:1},8,["disable","modelValue","options","display-value","error","onNewValue"])])])]),_:2},1024),o(te,{align:"right"},{default:s(()=>[o(V,{color:"secondary",label:"Cancel",onClick:e.cancelAddJob},null,8,["onClick"]),o(V,{color:"primary",label:"Submit Job",type:"submit"})]),_:1})]),_:2},1024)]),_:2},1032,["onSubmit"])])):(d(),c("div",Ke,[e.$can("create","jobs")?(d(),c("div",Ze,[o(V,{color:"primary",label:"Add Another Job",onClick:t[1]||(t[1]=r=>e.showAddJob=!0)})])):D("",!0),o(Ee,null,{default:s(()=>[_e,l("tbody",null,[(d(!0),c(x,null,ee(e.rows,r=>(d(),c("tr",{key:r[3]},[l("td",xe,m(r[18]),1),l("td",et,m(r.fixedRate>0?`$ ${r.fixedRate.toFixed(2)}`:"Edit to Add"),1),l("td",tt,m(r.timesRequested),1),l("td",ot,m(r.qtyRequested),1),l("td",at,[e.$can("manage","jobs")?(d(),E(V,{key:0,size:"sm",label:"edit",color:"primary",onClick:$=>e.editJob({craft:a,job:r})},null,8,["onClick"])):D("",!0)])]))),128))])]),_:2},1024)]))]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue","vertical"])]),_:1},8,["modelValue"])):(d(),c("div",ut,[o(be,{modelValue:e.tab,"onUpdate:modelValue":t[6]||(t[6]=a=>e.tab=a),align:"left",class:"shadow-2","indicator-color":"accent"},{default:s(()=>[(d(!0),c(x,null,ee(e.projectCrafts,a=>(d(),E(K,{key:a[3],name:a[3],label:a.abbr},null,8,["name","label"]))),128))]),_:1},8,["modelValue"]),o(fe,{modelValue:e.tab,"onUpdate:modelValue":t[10]||(t[10]=a=>e.tab=a),animated:""},{default:s(()=>[(d(!0),c(x,null,ee(e.projectCrafts,a=>(d(),E(Z,{key:a[3],name:a[3]},{default:s(()=>[e.showAddJob?(d(),c("div",$t,[o(ae,{onSubmit:oe(e.submitJob,["prevent"])},{default:s(()=>[o(B,{flat:""},{default:s(()=>[o(F,null,{default:s(()=>[o(H,{class:"q-mb-sm",dense:"",label:"Select Default Job","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.job,"onUpdate:modelValue":t[8]||(t[8]=r=>e.job=r),options:a.options.jobs,"option-label":"9","display-value":`${e.job?e.job[9]:""}`,"bottom-slots":"",error:!!e.formErrors.job},{error:s(()=>[l("div",wt,m(e.formErrors.job),1)]),_:2},1032,["modelValue","options","display-value","error"]),o(H,{disabled:!e.job,class:"q-mb-sm",dense:"",label:"Select Custom Job Title (Alias)","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.alias,"onUpdate:modelValue":t[9]||(t[9]=r=>e.alias=r),options:e.job?e.job.aliases:[],"option-label":"7","display-value":`${e.alias?e.alias[7]:""}`,"bottom-slots":"",error:!!e.formErrors.alias,onNewValue:e.submitAlias,"use-input":""},{error:s(()=>[l("div",qt,m(e.formErrors.alias),1)]),_:1},8,["disabled","modelValue","options","display-value","error","onNewValue"])]),_:2},1024),o(te,{align:"right"},{default:s(()=>[o(V,{color:"secondary",label:"Cancel",onClick:e.cancelAddJob},null,8,["onClick"]),o(V,{color:"primary",label:"Submit Job",type:"submit"})]),_:1})]),_:2},1024)]),_:2},1032,["onSubmit"])])):(d(),c("div",mt,[l("div",pt,[o(V,{color:"primary",label:"Add Another Job",onClick:t[7]||(t[7]=r=>e.showAddJob=!0)})]),o(Ee,null,{default:s(()=>[bt,l("tbody",null,[(d(!0),c(x,null,ee(e.rows,r=>(d(),c("tr",{key:r[3]},[l("td",ft,m(r[18]),1),l("td",ct,m(r.fixedRate>0?`$ ${r.fixedRate.toFixed(2)}`:"N/A"),1),l("td",gt,"$ "+m(r.avgRate.toFixed(2)),1),l("td",vt,m(r.timesRequested),1),l("td",yt,m(r.qtyRequested),1),l("td",ht,[o(V,{size:"sm",label:"edit",color:"primary",onClick:$=>e.editJob(r)},null,8,["onClick"])])]))),128))])]),_:1})]))]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])])),o(Pe,{modelValue:e.showEditJob,"onUpdate:modelValue":t[11]||(t[11]=a=>e.showEditJob=a),persistent:""},{default:s(()=>[o(n,{craft:e.editJobCraft,job:e.editJobJob,onCloseEditJob:e.closeEditJob},null,8,["craft","job","onCloseEditJob"])]),_:1},8,["modelValue"])])}var Nt=L(Ge,[["render",Vt]]);const Ct=O({components:{phoneNumberInput:De},setup(e,t){const i=ie(),p=h(10),u=h(null),{active:b}=se(X()),{userPermissions:n,getUser:a}=se(Te()),{addUser:r}=X(),$=T(()=>{const v=n.value.find(z=>z[7]==="create"&&z[16]==="users");return v!==void 0?v.roles:[]}),k=T(()=>{const v=new RegExp("^[0-9]{"+p.value+"}","g");return Y({firstName:M().required().label("First Name"),lastName:M().required().label("Last Name"),email:M().email().required().label("Email"),phoneNumber:M().matches(v,{excludeEmptyString:!0,message:"Valid Phone Number Required!"}).required().label("Phone Number"),role:Y().required().nullable().label("Role"),workdayId:M().required().label("Workday ID")})}),{meta:A,errors:P,handleSubmit:R,handleReset:g}=de({validationSchema:k}),{value:f}=j("firstName"),{value:y}=j("lastName"),{value:_}=j("email"),{value:W}=j("phoneNumber"),{value:q}=j("role"),{value:U}=j("workdayId"),le=R(async v=>{console.log(v);const z={userType:"Project User",phoneNumber:`+${u.value?u.value.dialCode:"1"}${v.phoneNumber}`,email:v.email};if(b.value.users.filter(re=>re[6]===z.email||re[8]===z.phoneNumber).length>0)i.dialog({title:"Alert",message:"Your project already has a user with that phone or email."}).onOk(()=>{t.emit("userAdded")});else{const re=await Q.checkIfUserExist(z);if(re){const{data:ue}=await Q.upsertRecordsXML({to:"br598isx6",data:[{6:{value:re[3]},7:{value:"Project"},9:{value:b.value[3]}}],fieldsToReturn:[28],formatObject:28});ue.length>0&&(r({user:ue[0][28]}),i.notify({type:"positive",message:"User successfully added"}),t.emit("userAdded"))}else{const ue=_.value.match(/^([^@]*)@/)[1],Se=Object.assign({phoneNumber:W.value},u.value),{data:$e}=await Q.upsertRecordsXML({to:"br4pxrbs6",data:[{6:{value:v.email},7:{value:"temp"},8:{value:`+${u.value?u.value.dialCode:"1"}${v.phoneNumber}`},9:{value:JSON.stringify(Se)},10:{value:"Active"},11:{value:v.role[3]},17:{value:!0},23:{value:a.value[3]},24:{value:a.value[3]},25:{value:new Date},26:{value:new Date},32:{value:"Project User"},33:{value:ue},35:{value:f.value},37:{value:y.value},49:{value:!0},50:{value:!0},70:{value:v.workdayId}}],fieldsToReturn:[3,96],formatObject:96});if($e[0]!==void 0){const me=await Q.upsertRecordsXML({to:"br598isx6",data:[{6:{value:$e[0][3]},7:{value:"Project"},9:{value:b.value[3]}}],fieldsToReturn:[28],formatObject:28});me.data[0]!==void 0&&(r({user:me.data[0][28]}),console.log(me.data[0][28]),i.dialog({title:"Confirm",message:"User successfully added. Would you like to send them an invite?",cancel:!0,persistent:!0}).onOk(async()=>{(await Q.upsertRecordsXML({to:"br4pxrbs6",data:[{3:{value:me.data[0][28][3]},93:{value:new Date}}],fieldsToReturn:[3]})).data[0]!==void 0&&(i.notify({type:"positive",message:"User successfully added"}),i.notify({type:"positive",message:"User invite submitted"}),t.emit("userAdded"))}).onCancel(()=>{i.notify({type:"positive",message:"User successfully added"}),t.emit("userAdded")}))}}}g()}),N=T(()=>{const v=[];return b.value.users.forEach(z=>{v.push(z[9].phoneNumber)}),v});ke(W,v=>{N.value.includes(v)&&i.notify({type:"negative",message:"Phone Number is already in use!",timeout:1e4,position:i.screen.lt.md?"top":"center"})});const C=v=>{u.value=v},w=v=>{p.value=v};function ce(){g(),t.emit("userCanceled")}return console.log(n.value,N.value),{updateCountry:C,updatePhoneMaxLength:w,firstName:f,lastName:y,email:_,phoneNumber:W,role:q,workdayId:U,formMeta:A,formErrors:P,submitUser:le,active:b,roleOptions:$,cancel:ce}}}),Et=l("div",{class:"text-primary text-h6 q-mb-sm"},"Add a New User",-1),kt={class:"row justify-between"},jt={class:"row justify-between"},At={class:"text-caption"},Rt={class:"text-caption"};function St(e,t,i,p,u,b){const n=I("phone-number-input");return d(),c("div",null,[o(B,null,{default:s(()=>[o(ae,{onSubmit:oe(e.submitUser,["prevent"])},{default:s(()=>[o(F,null,{default:s(()=>[Et,l("div",kt,[l("div",{class:S(["col-12 col-md-4",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[o(J,{dense:"",outlined:"",label:"First Name",modelValue:e.firstName,"onUpdate:modelValue":t[0]||(t[0]=a=>e.firstName=a),error:!!e.formErrors.firstName},null,8,["modelValue","error"])],2),l("div",{class:S(["col-12 col-md-4",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[o(J,{dense:"",outlined:"",label:"Last Name",modelValue:e.lastName,"onUpdate:modelValue":t[1]||(t[1]=a=>e.lastName=a),error:!!e.formErrors.lastName},null,8,["modelValue","error"])],2),l("div",{class:S(["col-12 col-md-4",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[o(J,{dense:"",outlined:"",label:"Workday ID",modelValue:e.workdayId,"onUpdate:modelValue":t[2]||(t[2]=a=>e.workdayId=a),error:!!e.formErrors.workdayId},null,8,["modelValue","error"])],2)]),l("div",jt,[l("div",{class:S(["col-12 col-md-4",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[o(n,{name:"phoneNumber",class:"col-xs-12 col-sm-12",outlined:"",modelValue:e.phoneNumber,"onUpdate:modelValue":t[3]||(t[3]=a=>e.phoneNumber=a),label:"Phone Number",tabindex:"3",onMaxLengthChanged:e.updatePhoneMaxLength,error:!!e.formErrors.phoneNumber,"error-message":e.formErrors.phoneNumber,onCountryChanged:e.updateCountry,dense:""},null,8,["modelValue","onMaxLengthChanged","error","error-message","onCountryChanged"])],2),l("div",{class:S(["col-12 col-md-4",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[o(J,{dense:"",outlined:"",label:"Email","bottom-slots":"",modelValue:e.email,"onUpdate:modelValue":t[4]||(t[4]=a=>e.email=a),error:!!e.formErrors.email},{error:s(()=>[l("div",At,m(e.formErrors.email),1)]),_:1},8,["modelValue","error"])],2),l("div",{class:S(["col-12 col-md-4",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[o(H,{dense:"",outlined:"",label:"Role","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.role,"onUpdate:modelValue":t[5]||(t[5]=a=>e.role=a),options:e.roleOptions,"option-label":"6","display-value":`${e.role?e.role[6]:""}`,"bottom-slots":"",error:!!e.formErrors.role},{error:s(()=>[l("div",Rt,m(e.formErrors.role),1)]),_:1},8,["modelValue","options","display-value","error"])],2)])]),_:1}),o(te,{align:"right"},{default:s(()=>[o(V,{color:"secondary",onClick:e.cancel,label:"Cancel"},null,8,["onClick"]),o(V,{color:"primary",type:"submit",label:"Submit"})]),_:1})]),_:1},8,["onSubmit"])]),_:1})])}var Ut=L(Ct,[["render",St]]);const Jt=[{name:0,label:"Date Created",align:"left",field:e=>e[1],format:e=>`${ve.formatDate(e.$d,"MM/DD/YYYY")}`,sortable:!0},{name:1,label:"Name",align:"left",field:e=>e[35],format:(e,t)=>`${e} ${t[37]}`,sortable:!0},{name:2,label:"Role",align:"left",field:e=>e[44],format:e=>`${e}`,sortable:!0},{name:3,label:"Email",align:"left",field:e=>e[6],format:e=>`${e}`,sortable:!0},{name:4,label:"Last Access",align:"left",field:e=>e.lastLogin,format:(e,t)=>`${t.registered?e.date:"Never"}`,sortable:!0}],Pt=O({components:{CreateUser:Ut},setup(){const{usersForProject:e}=se(X()),t=h(!1);function i(){t.value=!1}function p(u){console.log(u)}return{usersForProject:e,columns:Jt,initialPagination:{rowsPerPage:100},showAddUser:t,userAdded:i,sendInvite:p}}}),Dt={key:1};function Tt(e,t,i,p,u,b){const n=I("create-user");return d(),c("div",null,[e.showAddUser?(d(),c("div",Dt,[o(n,{onUserAdded:e.userAdded,onUserCanceled:t[1]||(t[1]=a=>e.showAddUser=!1)},null,8,["onUserAdded"])])):(d(),E(ge,{key:0,rows:e.usersForProject.sort((a,r)=>a[44]>r[44]?-1:1),columns:e.columns,"hide-pagination":!0,"row-key":"name",pagination:e.initialPagination,"table-header-class":"bg-dark text-white"},je({_:2},[e.$can("create","users")?{name:"top",fn:s(()=>[o(V,{color:"primary",label:"Add Another User",onClick:t[0]||(t[0]=a=>e.showAddUser=!0)}),o(Re)])}:void 0]),1032,["rows","columns","pagination"]))])}var Ft=L(Pt,[["render",Tt]]);const Qt=O({setup(e,t){const i=h(10),p=h(null),{capitalize:u}=Ae,{updateNewEmployee:b}=ne(),n=T(()=>{const f=new RegExp("^[0-9]{"+i.value+"}","g");return Y({firstName:M().required().label("First Name"),lastName:M().required().label("Last Name"),phoneNumber:M().matches(f,{excludeEmptyString:!0,message:"Valid Phone Number Required!"}).required().label("Phone Number")})}),{meta:a,errors:r,handleSubmit:$,handleReset:k}=de({validationSchema:n}),{value:A}=j("firstName"),{value:P}=j("lastName"),{value:R}=j("phoneNumber"),g=$(async f=>{const y={20:u(f.firstName.trim().toLowerCase()),22:u(f.lastName.trim().toLowerCase()),25:f.phoneNumber};b({info:y}),t.emit("complete",1),k()});return{country:p,firstName:A,lastName:P,phoneNumber:R,formMeta:a,formErrors:r,submit:g,cancel(){k(),t.emit("cancel")}}}}),Mt={class:"row justify-between"},It={class:"text-caption"},Ot={class:"text-caption"},Lt={class:"text-caption"};function Yt(e,t,i,p,u,b){return d(),c("div",null,[o(ae,{onSubmit:oe(e.submit,["prevent"])},{default:s(()=>[o(B,{flat:"",class:"q-pl-md q-mt-sm"},{default:s(()=>[o(F,{class:"q-px-none q-pb-none"},{default:s(()=>[l("div",Mt,[l("div",{class:S(["col-12 col-md-4",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[o(J,{dense:"",label:"First Name",modelValue:e.firstName,"onUpdate:modelValue":t[0]||(t[0]=n=>e.firstName=n),error:!!e.formErrors.firstName,"bottom-slots":""},{error:s(()=>[l("div",It,m(e.formErrors.firstName),1)]),_:1},8,["modelValue","error"])],2),l("div",{class:S(["col-12 col-md-4",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[o(J,{dense:"",label:"Last Name",modelValue:e.lastName,"onUpdate:modelValue":t[1]||(t[1]=n=>e.lastName=n),error:!!e.formErrors.lastName,"bottom-slots":""},{error:s(()=>[l("div",Ot,m(e.formErrors.lastName),1)]),_:1},8,["modelValue","error"])],2),l("div",{class:S(["col-12 col-md-4",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[o(J,{dense:"",label:"Phone Number",modelValue:e.phoneNumber,"onUpdate:modelValue":t[2]||(t[2]=n=>e.phoneNumber=n),error:!!e.formErrors.phoneNumber,"bottom-slots":""},{error:s(()=>[l("div",Lt,m(e.formErrors.phoneNumber),1)]),_:1},8,["modelValue","error"])],2)])]),_:1}),o(te,{align:"right"},{default:s(()=>[o(V,{color:"secondary",label:"Cancel",onClick:e.cancel},null,8,["onClick"]),o(V,{color:"primary",label:"Submit",type:"submit"})]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}var zt=L(Qt,[["render",Yt]]);const Xt=O({setup(e,t){const i=h(!0),{updateNewEmployee:p}=ne(),u=T(()=>Y({ssn:M().matches(/^[0-9]{9}/g,{excludeEmptyString:!0,message:"9 Digits required."}).nullable().required().label("Social Security Number"),ssnConfirmation:M().oneOf([Fe("ssn"),null],"Social Security Number must match").required().nullable().label("Confirm Social Security Number")})),{meta:b,errors:n,handleSubmit:a,handleReset:r}=de({validationSchema:u}),{value:$}=j("ssn"),{value:k}=j("ssnConfirmation"),A=a(async R=>{console.log(R);const g=await P();if(g)p({info:g}),t.emit("complete",2),r();else{const f={109:R.ssn};p({info:f}),t.emit("complete",2),r()}}),P=async()=>{const g=[{8:{value:`{'188'.EX.'${$.value}'}AND{'509'.EX.'false'}`},7:{value:"Employees"},9:{value:12}}],{data:f}=await Q.fetchFromHiringApp({fields:g});return f[0]?f[0]:null};return{ssn:$,ssnConfirmation:k,formMeta:b,formErrors:n,submit:A,isPwd:i,cancel(){r(),t.emit("cancel")}}}}),Bt={class:"row"},Wt={class:"col-12 col-md-5"},Ht={class:"text-caption"},Gt={class:"text-caption"};function Kt(e,t,i,p,u,b){return d(),c("div",null,[o(ae,{onSubmit:oe(e.submit,["prevent"])},{default:s(()=>[o(B,{flat:"",class:"q-pl-md q-mt-sm"},{default:s(()=>[o(F,{class:"q-px-none q-pb-none"},{default:s(()=>[l("div",Bt,[l("div",Wt,[o(J,{dense:"",label:"Enter Social Security Number",mask:"#########",modelValue:e.ssn,"onUpdate:modelValue":t[0]||(t[0]=n=>e.ssn=n),maxlength:"9",type:"password",error:!!e.formErrors.ssn,"bottom-slots":""},{error:s(()=>[l("div",Ht,m(e.formErrors.ssn),1)]),prepend:s(()=>[o(G,{name:"lock"})]),_:1},8,["modelValue","error"]),o(J,{dense:"",label:"Confirm Social Security Number",mask:"#########",modelValue:e.ssnConfirmation,"onUpdate:modelValue":t[2]||(t[2]=n=>e.ssnConfirmation=n),maxlength:"9",type:e.isPwd?"password":"text",error:!!e.formErrors.ssnConfirmation,"bottom-slots":""},{error:s(()=>[l("div",Gt,m(e.formErrors.ssnConfirmation),1)]),prepend:s(()=>[o(G,{name:"lock"})]),append:s(()=>[o(G,{name:e.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:t[1]||(t[1]=n=>e.isPwd=!e.isPwd)},null,8,["name"])]),_:1},8,["modelValue","type","error"])])])]),_:1}),o(te,{align:"right"},{default:s(()=>[o(V,{color:"secondary",label:"Cancel",onClick:e.cancel},null,8,["onClick"]),o(V,{color:"primary",label:"Submit",type:"submit"})]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}var Zt=L(Xt,[["render",Kt]]);const _t=O({components:{Personal:zt,EnterSsn:Zt},setup(){const e=h(0),{getNewEmployee:t}=ne();return{step:e,personalComplete(i){e.value=i},ssnComplete(i){e.value=i,console.log(t)}}}}),xt=ye(" Employee Personal Information "),eo=ye(" Identification ");function to(e,t,i,p,u,b){const n=I("personal"),a=I("enter-ssn");return d(),c("div",null,[o(B,null,{default:s(()=>[o(F,null,{default:s(()=>[l("div",{class:S(["text-primary",e.$q.screen.gt.sm?"text-h6":"text-body1"])},"Add a New Employee",2),l("div",{class:S(["text-dark text-italic",e.$q.screen.gt.sm?"text-body2":"text-caption"])},"Follow these steps to add a new employee.",2)]),_:1}),o(F,null,{default:s(()=>[l("div",{class:S([e.$q.screen.gt.sm?"text-body1":"text-body2",e.step===0?"text-info":e.step>0?"text-positive":"text-secondary"])},[e.$q.screen.gt.sm?(d(),E(G,{key:0,size:"md",color:e.step===0?"info":e.step>0?"positive":"secondary",name:"account_circle"},null,8,["color"])):D("",!0),xt],2),e.step===0?(d(),E(n,{key:0,onComplete:e.personalComplete,onCancel:t[0]||(t[0]=r=>e.$emit("cancelAddEmployee"))},null,8,["onComplete"])):D("",!0)]),_:1}),o(F,null,{default:s(()=>[l("div",{class:S([e.$q.screen.gt.sm?"text-body1":"text-body2",e.step===1?"text-info":e.step>1?"text-positive":"text-secondary"])},[e.$q.screen.gt.sm?(d(),E(G,{key:0,size:"md",color:e.step===1?"info":e.step>1?"positive":"secondary",name:"admin_panel_settings"},null,8,["color"])):D("",!0),eo],2),e.step===1?(d(),E(a,{key:0,onComplete:e.ssnComplete,onCancel:t[1]||(t[1]=r=>e.step=0)},null,8,["onComplete"])):D("",!0)]),_:1})]),_:1})])}var oo=L(_t,[["render",to]]);const{capitalize:pe}=Ae,he=e=>{const t=e[20]!==""?pe(e[20]):"",i=e[22]!==""?pe(e[22]):"",p=e[21]!==""?` ${pe(e[21])}`:"",u=e[23]!==""?` ${pe(e[23])}`:"";return`${i}${u}, ${t}${p}`},ao=[{name:1,label:"Name",align:"left",field:e=>e.employee[22],format:(e,t)=>`${he(t.employee)}`,sortable:!0},{name:7,label:"Workday ID",align:"left",field:e=>e.employee[378],format:e=>`${e}`,sortable:!0,sortOrder:"ad"},{name:2,label:"Payroll ID",align:"left",field:e=>e.employee[213],format:e=>e===""?"not available":e,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e.map.fullJob,format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:5,label:"Job #",align:"left",field:e=>e.map.jobNumber,format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0},{name:6,label:"Arrival Date",align:"left",field:e=>e.map.start,format:e=>`${e?ve.formatDate(e,"MM/DD/YYYY"):"TBD"}`,sortable:!0}],so=[{name:1,label:"Name",align:"left",field:e=>e.employee[22],format:(e,t)=>`${he(t.employee)}`,sortable:!0},{name:7,label:"Workday ID",align:"left",field:e=>e.employee[378],format:e=>`${e}`,sortable:!0,sortOrder:"ad"},{name:2,label:"Payroll ID",align:"left",field:e=>e.employee[213],format:e=>e===""?"not available":e,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e.map.fullJob,format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:5,label:"Job #",align:"left",field:e=>e.map.jobNumber,format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0},{name:6,label:"Arrival Date",align:"left",field:e=>e.map.start,format:e=>`${e?ve.formatDate(e,"MM/DD/YYYY"):"TBD"}`,sortable:!0}],lo=O({name:"Table",components:{AddNewEmployee:oo},setup(){const e=ie(),t=ne(),i=X(),{assignmentsForProject:p,getFlaggedAssignments:u}=se(t),b=p,{active:n}=se(X()),{getAssignments:a,flagAssignment:r}=ne(),$=h(""),k=h(null),A=h(null),P=h(0),R=h(!1),g=h(!1);a();const f=T(()=>{let q=[];return b.value.forEach(U=>{U[75].toLowerCase().includes($.value.toLowerCase())&&q.push(U)}),q=k.value?q.filter(U=>we(U[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===we(k.value).tz("America/Chicago").format("MM/DD/YYYY")):q,q=A.value?q.filter(U=>U[68]===A.value):q,q.sort((U,le)=>U.employee[24]>le.employee[24]?1:-1)}),y=T(()=>e.screen.lt.md?100:25),_=T(()=>[...new Map(p.value.map(q=>[q[68],q[68]])).values()]);async function W(q){r({record:q.rows[0],status:q.added})}return{columns:ao,mobileColumns:so,rows:f,initialPagination:{rowsPerPage:y},separator:"vertical",projectStore:i,active:n,search:$,startDateFilter:k,craftOptions:_,craftFilter:A,assignmentsForProject:p,tab:P,showEmployee:R,formatName:he,updateAssignment:W,getFlaggedAssignments:u,showAddEmployee:g}}}),ro={class:"q-px-sm"},no={class:"row items-center"},io={class:"col-12 col-md-4 q-px-sm"},uo={class:"col-12 col-md-4 q-px-sm"},mo={class:"col-12 col-md-4 q-px-sm"},po={class:"text-primary text-italic"},bo={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},fo={class:"text-dark text-caption text-italic"},co={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"};function go(e,t,i,p,u,b){const n=I("add-new-employee");return d(),c("div",ro,[l("div",null,[o(Ce,null,{default:s(()=>[qe(l("div",null,[o(be,{modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=a=>e.tab=a),"bg-color":"none","indicator-color":"accent",align:"left",dense:""},{default:s(()=>[o(K,{name:0,label:e.$q.screen.gt.xs?"All Employees":"Employees"},null,8,["label"]),o(K,{name:1,label:"Flagged to Remove"},{default:s(()=>[e.getFlaggedAssignments.length>0?(d(),E(Oe,{key:0,color:"accent",floating:"",transparent:""},{default:s(()=>[ye(m(e.getFlaggedAssignments.length),1)]),_:1})):D("",!0)]),_:1})]),_:1},8,["modelValue"]),o(fe,{modelValue:e.tab,"onUpdate:modelValue":t[5]||(t[5]=a=>e.tab=a),animated:""},{default:s(()=>[o(Z,{class:"q-px-xs",name:0},{default:s(()=>[o(B,{flat:""},{default:s(()=>[o(F,{class:"q-pt-none"},{default:s(()=>[l("div",no,[l("div",io,[o(J,{dense:e.$q.screen.lt.md,modelValue:e.search,"onUpdate:modelValue":t[1]||(t[1]=a=>e.search=a),label:"Search"},null,8,["dense","modelValue"])]),l("div",uo,[o(J,{dense:e.$q.screen.lt.md,modelValue:e.startDateFilter,"onUpdate:modelValue":t[2]||(t[2]=a=>e.startDateFilter=a),label:"Arrival Date",type:"date","stack-label":""},null,8,["dense","modelValue"])]),l("div",mo,[o(H,{dense:e.$q.screen.lt.md,label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.craftFilter,"onUpdate:modelValue":t[3]||(t[3]=a=>e.craftFilter=a),options:e.craftOptions,"use-chips":""},null,8,["dense","modelValue","options"])])])]),_:1})]),_:1}),o(ge,{"title-class":e.$q.screen.gt.sm?"text-primary text-h6":"text-primary text-body1",title:e.$q.screen.lt.sm?"Employees":`Employees for ${e.active[20]}`,columns:e.$q.screen.lt.md?e.mobileColumns:e.columns,rows:e.rows,"row-key":"3",class:"q-pa-sm",pagination:e.initialPagination,separator:"vertical","table-header-class":"bg-dark text-white","no-data-label":`There are no employees for ${e.active[20]}`,grid:e.$q.screen.lt.sm,selection:"multiple",selected:e.getFlaggedAssignments,onSelection:e.updateAssignment},je({"top-right":s(()=>[l("div",po,m(e.assignmentsForProject.length)+" total employees / "+m(e.getFlaggedAssignments.length)+" flagged to remove",1)]),"header-selection":s(a=>[o(Ne,{disable:"",modelValue:a.selected,"onUpdate:modelValue":r=>a.selected=r},null,8,["modelValue","onUpdate:modelValue"])]),"body-selection":s(a=>[o(Ne,{modelValue:a.selected,"onUpdate:modelValue":r=>a.selected=r},null,8,["modelValue","onUpdate:modelValue"])]),"no-data":s(({message:a})=>[l("div",bo,[o(G,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),l("span",null,m(a),1)])]),_:2},[e.$can("manage","employees")?{name:"top-left",fn:s(()=>[o(V,{color:"primary",label:"Add Another Employee",onClick:t[4]||(t[4]=a=>e.showAddEmployee=!0)}),o(Re)])}:void 0]),1032,["title-class","title","columns","rows","pagination","no-data-label","grid","selected","onSelection"])]),_:1}),o(Z,{class:"q-px-xs",name:1},{default:s(()=>[o(ge,{"title-class":e.$q.screen.gt.sm?"text-primary text-h6":"text-primary text-body1",title:e.$q.screen.lt.sm?"Flagged to Remove":`Flagged to Remove from ${e.active[20]}`,columns:e.$q.screen.lt.md?e.mobileColumns:e.columns,rows:e.getFlaggedAssignments,"row-key":"3",class:"q-pa-sm",pagination:e.initialPagination,separator:"vertical","table-header-class":"bg-dark text-white","no-data-label":`There are no employees to remove from ${e.active[20]}`,grid:e.$q.screen.lt.sm},{"top-right":s(()=>[l("div",fo,"(Total: "+m(e.getFlaggedAssignments.length)+" to remove)",1)]),"no-data":s(({message:a})=>[l("div",co,[o(G,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),l("span",null,m(a),1)])]),_:1},8,["title-class","title","columns","rows","pagination","no-data-label","grid"])]),_:1})]),_:1},8,["modelValue"])],512),[[Ve,!e.showAddEmployee]])]),_:1}),o(Ce,null,{default:s(()=>[qe(l("div",null,[o(n,{onCancelAddEmployee:t[6]||(t[6]=a=>e.showAddEmployee=!1)})],512),[[Ve,e.showAddEmployee]])]),_:1})])])}var vo=L(lo,[["render",go],["__scopeId","data-v-7a1c64e6"]]);const yo=O({name:"Projects",components:{JobsTab:Nt,UsersTab:Ft,EmployeesTab:vo},setup(){return ie(),{tab:h(0)}}}),ho={class:"q-px-sm"};function $o(e,t,i,p,u,b){const n=I("jobs-tab"),a=I("users-tab"),r=I("employees-tab");return d(),c("div",ho,[o(Qe,{class:"bg-info text-white shadow-2 rounded-borders"},{default:s(()=>[o(be,{modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=$=>e.tab=$),"bg-color":"none","indicator-color":"accent",align:"justify",dense:""},{default:s(()=>[o(K,{name:0,label:e.$q.screen.gt.xs?"Available Jobs":"Jobs"},null,8,["label"]),e.$can("read","users")?(d(),E(K,{key:0,name:1,label:"Users"})):D("",!0),e.$can("manage","employees")?(d(),E(K,{key:1,name:2,label:"Employees"})):D("",!0)]),_:1},8,["modelValue"])]),_:1}),o(fe,{modelValue:e.tab,"onUpdate:modelValue":t[1]||(t[1]=$=>e.tab=$),animated:""},{default:s(()=>[o(Z,{class:"q-px-xs",name:0},{default:s(()=>[o(n)]),_:1}),e.$can("read","users")?(d(),E(Z,{key:0,class:"q-px-xs",name:1},{default:s(()=>[o(a)]),_:1})):D("",!0),e.$can("manage","employees")?(d(),E(Z,{key:1,class:"q-px-xs",name:2},{default:s(()=>[o(r)]),_:1})):D("",!0)]),_:1},8,["modelValue"])])}var wo=L(yo,[["render",$o]]);const qo=O({name:"PageIndex",components:{ProjectTabs:wo},setup(){return{}}});function Vo(e,t,i,p,u,b){const n=I("project-tabs");return d(),E(Me,{style:{"max-width":"100vw"}},{default:s(()=>[o(n)]),_:1})}var Jo=L(qo,[["render",Vo]]);export{Jo as default};
